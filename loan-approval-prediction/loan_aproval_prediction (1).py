# -*- coding: utf-8 -*-
"""Loan Aproval Prediction

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1KI2zYAsgLupgGM4rQDGMWwdHdBQcix4J

Load the dataset
"""

import pandas as pd

# Connect to google drive
from google.colab import drive
drive.mount('/content/drive')

# Load the CSV file with the actual filename
df = pd.read_csv("/content/drive/MyDrive/Datasets/Loan approval dataset .csv")

# Preview first rows
df.head()

"""Handling missing values"""

# Check missing values per column
missing = df.isna().sum()
print(missing[missing > 0])

# Categorical columns to fill with mode
cat_cols = [
    'Gender', 'Married', 'Dependents',
    'Self_Employed', 'Credit_History',
    'Loan_Amount_Term'
]

# Fill categorical missing values (no inplace to avoid pandas warning)
for col in cat_cols:
    df[col] = df[col].fillna(df[col].mode().iat[0])

# Fill numeric missing values with median
df['LoanAmount'] = df['LoanAmount'].fillna(df['LoanAmount'].median())

"""Exploratory Visualizations"""

print(df.columns)

"""Add a Simulated Loan_Status Column"""

import numpy as np

# Add a simulated Loan_Status column
# 70% of the loans approved ('Y'), 30% rejected ('N')
df['Loan_Status'] = np.random.choice(['Y', 'N'], size=len(df), p=[0.7, 0.3])

# Verify it worked
print(df['Loan_Status'].value_counts())

"""Run EDA Visualization"""

import seaborn as sns
import matplotlib.pyplot as plt

# Count of approved vs rejected loans
sns.countplot(
    data=df,
    x='Loan_Status',
    hue='Loan_Status',   # required when using palette
    palette='Blues',
    legend=False         # avoids duplicate legend
)

plt.title("Loan Approval Distribution")
plt.show()

import seaborn as sns
import matplotlib.pyplot as plt

# Applicant income distribution by loan status (warning-free)
sns.boxplot(
    data=df,
    x='Loan_Status',
    y='ApplicantIncome',
    hue='Loan_Status',   # required when using palette
    palette='Purples',
    legend=False         # avoids duplicate legend
)

plt.title("Applicant Income by Loan Status")
plt.show()

###Credit History Vs Loan Status
sns.countplot(data=df, x='Credit_History', hue='Loan_Status', palette='Set2')
plt.title("Loan Approval by Credit History")
plt.show()

###Cleaned Data Set
from google.colab import files

# Save the cleaned DataFrame to a CSV
df.to_csv("loan_data_cleaned_with_status.csv", index=False)

# Download the file
files.download("loan_data_cleaned_with_status.csv")